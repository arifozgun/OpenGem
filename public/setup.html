<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenGem — Setup</title>
    <meta name="description" content="Configure your free OpenGem server in minutes.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/setup.css">
    <link rel="icon" href="/logos/black.png" media="(prefers-color-scheme: light)">
    <link rel="icon" href="/logos/white.png" media="(prefers-color-scheme: dark)">
</head>

<body>
    <div class="setup-container">
        <!-- Header -->
        <div class="setup-header">
            <div class="logo-icon">
                <img src="/logos/black.png" alt="OpenGem Logo" width="64" height="64" style="object-fit: contain;">
            </div>
            <h1>OpenGem</h1>
            <p class="subtitle">Open-source AI API gateway for Gemini models</p>
        </div>

        <!-- Progress Steps -->
        <div class="progress-bar">
            <div class="step active" data-step="1">
                <div class="step-circle">1</div>
                <span class="step-label">Backend</span>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="2">
                <div class="step-circle">2</div>
                <span class="step-label" id="step2Label">Firebase</span>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="3">
                <div class="step-circle">3</div>
                <span class="step-label">Admin</span>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="4">
                <div class="step-circle">4</div>
                <span class="step-label">Complete</span>
            </div>
        </div>

        <!-- Step 1: Backend Selection -->
        <div class="step-content active" id="step-1">
            <div class="step-card">
                <div class="step-card-header">
                    <h2>Choose Database Backend</h2>
                    <p>Select where OpenGem stores your accounts, API keys, and logs. You can switch backends later from
                        the dashboard.</p>
                </div>
                <div class="backend-grid">
                    <button type="button" class="backend-card selected" id="backendSqlite" data-backend="sqlite">
                        <div class="backend-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <ellipse cx="12" cy="5" rx="9" ry="3" />
                                <path d="M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5" />
                                <path d="M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3" />
                            </svg>
                        </div>
                        <div class="backend-info">
                            <strong>SQLite</strong>
                            <span>Single-file embedded database. ACID-safe, crash-proof, and fast. Ideal for production self-hosting.</span>
                        </div>
                        <div class="backend-check">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                        </div>
                        <span class="backend-badge">Recommended</span>
                    </button>
                    <button type="button" class="backend-card" id="backendLocal" data-backend="local">
                        <div class="backend-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <rect x="2" y="3" width="20" height="14" rx="2" />
                                <path d="M8 21h8M12 17v4" />
                            </svg>
                        </div>
                        <div class="backend-info">
                            <strong>Local JSON File</strong>
                            <span>Stored in <code>data/db.json</code> on the server. Simple, no extra dependencies.</span>
                        </div>
                        <div class="backend-check">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                        </div>
                    </button>
                    <button type="button" class="backend-card" id="backendFirebase" data-backend="firebase">
                        <div class="backend-icon">
                            <img src="/icons/firebase.png" alt="Firebase" width="32" height="32"
                                style="object-fit: contain;">
                        </div>
                        <div class="backend-info">
                            <strong>Firebase Firestore</strong>
                            <span>Uses Google Firebase for cloud-based storage. Requires a Firebase project.</span>
                        </div>
                        <div class="backend-check">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                        </div>
                    </button>
                </div>
                <div class="step-actions">
                    <div></div>
                    <button type="button" class="btn btn-primary" id="nextToStep2">
                        Continue
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="9 18 15 12 9 6" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 2: Firebase Config (shown only for firebase backend) -->
        <div class="step-content" id="step-2">
            <div class="step-card" id="step2Firebase">
                <div class="step-card-header">
                    <h2 style="display:flex; align-items:center; gap:10px;">
                        <img src="/icons/firebase.png" alt="Firebase" width="24" height="24"
                            style="object-fit:contain; flex-shrink:0;">
                        Firebase Configuration
                    </h2>
                    <p>Paste your Firebase project config. You can find this in your
                        <a href="https://console.firebase.google.com" target="_blank" rel="noopener">Firebase
                            Console</a>
                        → Project Settings → General → Your apps → Config.
                    </p>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="fb-apiKey">API Key <span class="required">*</span></label>
                        <input type="text" id="fb-apiKey" placeholder="AIzaSy..." required>
                    </div>
                    <div class="form-group">
                        <label for="fb-authDomain">Auth Domain <span class="required">*</span></label>
                        <input type="text" id="fb-authDomain" placeholder="your-app.firebaseapp.com" required>
                    </div>
                    <div class="form-group">
                        <label for="fb-projectId">Project ID <span class="required">*</span></label>
                        <input type="text" id="fb-projectId" placeholder="your-project-id" required>
                    </div>
                    <div class="form-group">
                        <label for="fb-storageBucket">Storage Bucket <span class="required">*</span></label>
                        <input type="text" id="fb-storageBucket" placeholder="your-app.appspot.com" required>
                    </div>
                    <div class="form-group">
                        <label for="fb-messagingSenderId">Messaging Sender ID <span class="required">*</span></label>
                        <input type="text" id="fb-messagingSenderId" placeholder="123456789" required>
                    </div>
                    <div class="form-group">
                        <label for="fb-appId">App ID <span class="required">*</span></label>
                        <input type="text" id="fb-appId" placeholder="1:123456:web:abc123" required>
                    </div>
                    <div class="form-group full-width">
                        <label for="fb-measurementId">Measurement ID <span class="optional">(optional)</span></label>
                        <input type="text" id="fb-measurementId" placeholder="G-XXXXXXXXXX">
                    </div>
                </div>
                <div class="paste-config-area">
                    <button type="button" class="btn btn-ghost" id="pasteJsonBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                        </svg>
                        Paste Firebase Config JSON
                    </button>
                </div>
                <div class="step-actions">
                    <button type="button" class="btn btn-ghost" id="backToStep1">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="15 18 9 12 15 6" />
                        </svg>
                        Back
                    </button>
                    <button type="button" class="btn btn-primary" id="nextToStep3">
                        Continue
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="9 18 15 12 9 6" />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- SQLite backend: confirmation card -->
            <div class="step-card hidden" id="step2Sqlite">
                <div class="step-card-header">
                    <h2>SQLite Database Confirmed</h2>
                    <p>OpenGem will store all data in <code>data/opengem.db</code> on your server using SQLite — a
                        production-grade embedded database with full ACID guarantees.</p>
                </div>
                <div class="local-confirm-info">
                    <div class="info-row">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--green)"
                            stroke-width="2">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                        <span>ACID transactions — a crash mid-write cannot corrupt your data</span>
                    </div>
                    <div class="info-row">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--green)"
                            stroke-width="2">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                        <span>WAL mode — concurrent reads without blocking writes</span>
                    </div>
                    <div class="info-row">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--green)"
                            stroke-width="2">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                        <span>All tokens are AES-256-GCM encrypted at rest</span>
                    </div>
                    <div class="info-row">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--green)"
                            stroke-width="2">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                        <span>API keys stored as SHA-256 hashes (never plaintext)</span>
                    </div>
                    <div class="info-row">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent)"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="8" x2="12" y2="12" />
                            <line x1="12" y1="16" x2="12.01" y2="16" />
                        </svg>
                        <span>Back up <code>data/opengem.db</code> periodically — it is not synced to the cloud</span>
                    </div>
                </div>
                <div class="step-actions">
                    <button type="button" class="btn btn-ghost" id="backToStep1Sqlite">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="15 18 9 12 15 6" />
                        </svg>
                        Back
                    </button>
                    <button type="button" class="btn btn-primary" id="nextToStep3Sqlite">
                        Continue
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="9 18 15 12 9 6" />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Local JSON backend: confirmation card -->
            <div class="step-card hidden" id="step2Local">
                <div class="step-card-header">
                    <h2>Local Database Confirmed</h2>
                    <p>OpenGem will store all data in <code>data/db.json</code> on your server. No external services are
                        required.</p>
                </div>
                <div class="local-confirm-info">
                    <div class="info-row">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--green)"
                            stroke-width="2">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                        <span>All tokens are AES-256-GCM encrypted at rest</span>
                    </div>
                    <div class="info-row">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--green)"
                            stroke-width="2">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                        <span>API keys stored as SHA-256 hashes (never plaintext)</span>
                    </div>
                    <div class="info-row">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--green)"
                            stroke-width="2">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                        <span>Logs capped at 5,000 entries automatically</span>
                    </div>
                    <div class="info-row">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent)"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="8" x2="12" y2="12" />
                            <line x1="12" y1="16" x2="12.01" y2="16" />
                        </svg>
                        <span>Back up <code>data/db.json</code> periodically — it is not synced to the cloud</span>
                    </div>
                </div>
                <div class="step-actions">
                    <button type="button" class="btn btn-ghost" id="backToStep1Local">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="15 18 9 12 15 6" />
                        </svg>
                        Back
                    </button>
                    <button type="button" class="btn btn-primary" id="nextToStep3Local">
                        Continue
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="9 18 15 12 9 6" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 3: Admin Account -->
        <div class="step-content" id="step-3">
            <div class="step-card">
                <div class="step-card-header">
                    <h2>Admin Account</h2>
                    <p>Create your admin credentials to access the dashboard. You'll use these to manage Google
                        accounts, API keys, and monitor usage.</p>
                </div>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="admin-username">Username <span class="required">*</span></label>
                        <input type="text" id="admin-username" placeholder="admin" required autocomplete="username">
                    </div>
                    <div class="form-group full-width">
                        <label for="admin-password">Password <span class="required">*</span></label>
                        <input type="password" id="admin-password" placeholder="Min 8 characters" required
                            autocomplete="new-password">
                    </div>
                    <div class="form-group full-width">
                        <label for="admin-password-confirm">Confirm Password <span class="required">*</span></label>
                        <input type="password" id="admin-password-confirm" placeholder="Repeat password" required
                            autocomplete="new-password">
                    </div>
                </div>
                <div class="step-actions">
                    <button type="button" class="btn btn-ghost" id="backToStep2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="15 18 9 12 15 6" />
                        </svg>
                        Back
                    </button>
                    <button type="button" class="btn btn-primary" id="completeSetup">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                            <polyline points="22 4 12 14.01 9 11.01" />
                        </svg>
                        Complete Setup
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 4: Complete -->
        <div class="step-content" id="step-4">
            <div class="step-card step-card-success">
                <div class="success-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                        <polyline points="22 4 12 14.01 9 11.01" />
                    </svg>
                </div>
                <h2>Setup Complete.</h2>
                <p class="success-desc">Your OpenGem server is ready.</p>
                <div class="step-actions center" style="margin-top: 32px;">
                    <a href="/" class="btn btn-primary btn-lg">
                        Open Dashboard
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="9 18 15 12 9 6" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>

        <!-- Error alert -->
        <div id="setupError" class="alert alert-error hidden"></div>
    </div>

    <script src="/setup.js"></script>
</body>

</html>